{% extends 'mvp/generic/content.html' %}

{% block content %}
    <article class="media content-section">
        <div class="media-body">
            <h2 class="article-title">{{ object.description }}</h2>
            <hr>
            <div class="article-metadata">
                <b class="text-gray-900">Client: {{ object.client }}</b><br>
                <b class="text-gray-900">BizDev: {{ object.commercial }}</b><br>
                <b class="text-gray-900">Factu: {{ object.factu_manager }}</b><br>
            </div>
            <hr>
            <table class="table table-hover table-bordered">
                <thead class="thead-dark">
                <tr>
                    <th scope="col">Prix</th>
                    <th scope="col">Facturation</th>
                    <th scope="col">Start Date</th>
                    <th scope="col">End Date</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td class="article-content">{{ object.price }}</td>
                    <td class="article-content">{{ object.facturation }}</td>
                    <td class="article-content">{{ object.start_date }}</td>
                    <td class="article-content">{{ object.end_date }}</td>
                </tr>
                </tbody>
            </table>
            <hr>
            <table class="table table-hover table-bordered">
                <thead class="thead-dark">
                <tr>
                    <th scope="col">Licenses</th>
                    <th scope="col">Conseil</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>
                        {% if licenses %}
                            {% for license in licenses %}
                                <a href= {% url 'mvp-license-details' object.company.id object.id license.id %}>
                                    {{ license }} start:{{ license.start_date }} duration:{{ license.duration }}
                                    price:{{ license.price }}</a>
                                <br>
                                <hr>
                            {% endfor %}
                        {% else %}
                            Ce contrat n'as pas de license actuellement.
                            <hr><br>
                        {% endif %}
                        {% if not object.validated %}
                            <a class="btn btn-success btn-icon-split" href=
                                    {% url 'mvp-license-new' object.company.id object.id %}>
                                <span class="icon text-white-50"><i class="fas fa-plus-square"></i></span>
                                <span class="text">Ajouter une license</span>
                            </a>
                        {% endif %}
                    </td>
                    <td>
                        {% if conseils %}
                            {% for conseil in conseils %}
                                <a href= {% url 'mvp-conseil-details' object.company.id object.id conseil.id %}>
                                    {{ conseil }} price: {{ conseil.price }} nb de
                                    service:{{ conseil.service_set.all.count }}</a>
                                <br>
                                <hr>
                            {% endfor %}
                        {% else %}
                            Ce contrat n'as pas de conseil actuellement.
                            <hr><br>
                        {% endif %}
                        {% if not object.validated %}
                            <a class="btn btn-success btn-icon-split" href=
                                    {% url 'mvp-conseil-new' object.company.id object.id %}>
                                <span class="icon text-white-50"><i class="fas fa-plus-square"></i></span>
                                <span class="text">Ajouter un conseil</span>
                            </a>
                        {% endif %}
                    </td>
                </tr>
                </tbody>
            </table>
            {% if not object.validated %}
                <form method="post">
                    {% csrf_token %}
                    {% include 'mvp/generic/form.html' %}
                    <button class="btn btn-success btn-icon-split" type="submit">
                        <span class="icon text-white-50"><i class="fas fa-check"></i></span>
                        <span class="text">Valider le contrat.</span>
                    </button>
                </form>
            {% else %}
                <a class="btn btn-secondary btn-icon-split"
                   href= {{ request.META.HTTP_REFERER }}>
                    <span class="icon text-white-50"><i class="fas fa-arrow-right"></i></span>
                    <span class="text">Retour</span>
                </a>
            {% endif %}
        </div>
    </article>
{% endblock %}
